<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskMaster Pro - –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á</title>
    
    <!-- PWA Meta tags -->
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="TaskMaster Pro">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236366f1'><path d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'/></svg>">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal.active {
            display: flex;
        }
        
        .task-card {
            transition: all 0.3s ease;
        }
        
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .priority-high { border-left-color: #ef4444; }
        .priority-medium { border-left-color: #eab308; }
        .priority-low { border-left-color: #22c55e; }
        
        .overdue {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid rgba(239, 68, 68, 0.2);
        }
        
        .notification-permission {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 999;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none;
        }
        
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none;
            z-index: 999;
        }

        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(156, 163, 175, 0.5); border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(156, 163, 175, 0.8); }
    </style>
</head>
<body>
    <!-- Notification Permission Button -->
    <div id="notificationBtn" class="notification-permission" onclick="requestNotificationPermission()">
        üîî –í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    </div>

    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt" onclick="installApp()">
        üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    </div>

    <div id="app" class="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50">
        <!-- Header -->
        <div class="bg-white/80 backdrop-blur-md border-b border-gray-200 sticky top-0 z-10">
            <div class="max-w-4xl mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-2 rounded-xl">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                                TaskMaster Pro
                            </h1>
                            <div id="statsBar" class="flex items-center space-x-4 text-sm text-gray-600">
                                <span id="activeCount">üìä 0 –∞–∫—Ç–∏–≤–Ω—ã—Ö</span>
                                <span id="overdueCount" class="text-red-500 font-medium hidden">‚ö†Ô∏è 0 –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
                                <span id="recurringCount">üîÑ 0 –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <button onclick="toggleSettings()" class="p-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors duration-200" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </button>
                        
                        <button id="notificationToggle" onclick="toggleNotifications()" class="p-2 rounded-lg transition-colors duration-200 text-gray-400 hover:text-gray-600 hover:bg-gray-50" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                            </svg>
                        </button>
                        
                        <button onclick="toggleAddForm()" class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-4 py-2 rounded-xl flex items-center space-x-2 hover:shadow-lg transform hover:scale-105 transition-all duration-200">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                            </svg>
                            <span>–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-4xl mx-auto px-4 py-6">
            <!-- Controls -->
            <div class="bg-white/60 backdrop-blur-sm rounded-2xl p-4 mb-6 border border-gray-200">
                <div class="flex flex-col md:flex-row gap-4">
                    <!-- Search -->
                    <div class="flex-1 relative">
                        <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –∑–∞–¥–∞—á..." onkeyup="filterTasks()" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    
                    <!-- Filter -->
                    <div class="flex space-x-2" id="filterButtons">
                        <button onclick="setFilter('active')" class="filter-btn active flex items-center space-x-2 px-4 py-2 rounded-xl transition-all duration-200 bg-indigo-500 text-white shadow-lg">
                            <span>–ê–∫—Ç–∏–≤–Ω—ã–µ</span>
                            <span id="activeFilterCount" class="text-xs px-2 py-1 rounded-full bg-white/20">0</span>
                        </button>
                        <button onclick="setFilter('recurring')" class="filter-btn flex items-center space-x-2 px-4 py-2 rounded-xl transition-all duration-200 bg-white text-gray-600 hover:bg-gray-50 border border-gray-200">
                            <span>–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ</span>
                            <span id="recurringFilterCount" class="text-xs px-2 py-1 rounded-full bg-gray-100">0</span>
                        </button>
                        <button onclick="setFilter('completed')" class="filter-btn flex items-center space-x-2 px-4 py-2 rounded-xl transition-all duration-200 bg-white text-gray-600 hover:bg-gray-50 border border-gray-200">
                            <span>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</span>
                            <span id="completedFilterCount" class="text-xs px-2 py-1 rounded-full bg-gray-100">0</span>
                        </button>
                        <button onclick="setFilter('all')" class="filter-btn flex items-center space-x-2 px-4 py-2 rounded-xl transition-all duration-200 bg-white text-gray-600 hover:bg-gray-50 border border-gray-200">
                            <span>–í—Å–µ</span>
                            <span id="allFilterCount" class="text-xs px-2 py-1 rounded-full bg-gray-100">0</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Task List -->
            <div id="taskList" class="space-y-4">
                <!-- –ó–∞–¥–∞—á–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <!-- Empty State -->
            <div id="emptyState" class="text-center py-12 hidden">
                <div class="bg-gray-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <p class="text-gray-500 text-lg" id="emptyStateText">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</p>
                <p class="text-gray-400 text-sm mt-2">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!</p>
            </div>
        </div>
    </div>

    <!-- Add Task Modal -->
    <div id="addTaskModal" class="modal">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-800">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h2>
                <button onclick="closeAddForm()" class="p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 transition-colors duration-200">‚úï</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
                    <input type="text" id="taskTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="taskDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)..." rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                        <select id="taskPriority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="low">üü¢ –ù–∏–∑–∫–∏–π</option>
                            <option value="medium" selected>üü° –°—Ä–µ–¥–Ω–∏–π</option>
                            <option value="high">üî¥ –í—ã—Å–æ–∫–∏–π</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="taskCategory" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="personal">üè† –õ–∏—á–Ω–æ–µ</option>
                            <option value="work">üíº –†–∞–±–æ—Ç–∞</option>
                            <option value="health">üí™ –ó–¥–æ—Ä–æ–≤—å–µ</option>
                            <option value="study">üìö –£—á—ë–±–∞</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</label>
                    <input type="datetime-local" id="taskDueDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>

                <div class="space-y-3">
                    <div class="flex items-center space-x-3">
                        <input type="checkbox" id="taskRecurring" class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                        <label for="taskRecurring" class="text-sm font-medium text-gray-700">üîÑ –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –∑–∞–¥–∞—á–∞</label>
                    </div>

                    <div id="recurringOptions" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ß–∞—Å—Ç–æ—Ç–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</label>
                        <select id="taskRecurringType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
                            <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
                            <option value="monthly">–ï–∂–µ–º–µ—Å—è—á–Ω–æ</option>
                        </select>
                    </div>

                    <div class="flex items-center space-x-3">
                        <input type="checkbox" id="taskReminder" checked class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                        <label for="taskReminder" class="text-sm font-medium text-gray-700">üîî –í–∫–ª—é—á–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</label>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-3 mt-6">
                <button onclick="closeAddForm()" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="addTask()" class="flex-1 px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg hover:shadow-lg transition-all duration-200">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-800">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <button onclick="closeSettings()" class="p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100 transition-colors duration-200">‚úï</button>
            </div>
            
            <div class="space-y-6">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="font-semibold text-gray-800 mb-3">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="text-center">
                            <div id="totalTasks" class="text-2xl font-bold text-indigo-600">0</div>
                            <div class="text-gray-600">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                        </div>
                        <div class="text-center">
                            <div id="completedTasks" class="text-2xl font-bold text-green-600">0</div>
                            <div class="text-gray-600">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                        </div>
                        <div class="text-center">
                            <div id="recurringTasks" class="text-2xl font-bold text-blue-600">0</div>
                            <div class="text-gray-600">–ü–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö</div>
                        </div>
                        <div class="text-center">
                            <div id="overdueTasks" class="text-2xl font-bold text-red-600">0</div>
                            <div class="text-gray-600">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div>
                        </div>
                    </div>
                </div>

                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                <div>
                    <h3 class="font-semibold text-gray-800 mb-3">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-700">–ë—Ä–∞—É–∑–µ—Ä–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                            <span id="notificationStatus" class="text-sm px-2 py-1 rounded bg-red-100 text-red-700">–û—Ç–∫–ª—é—á–µ–Ω—ã</span>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-700">–ó–≤—É–∫–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã</span>
                            <input type="checkbox" id="soundToggle" checked class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                        </div>
                    </div>
                </div>

                <!-- –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                <div>
                    <h3 class="font-semibold text-gray-800 mb-3">üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
                    <div class="space-y-3">
                        <button onclick="exportData()" class="w-full flex items-center justify-center space-x-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            <span>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</span>
                        </button>
                        
                        <input type="file" id="importFile" accept=".json" onchange="importData(event)" style="display: none;">
                        <button onclick="document.getElementById('importFile').click()" class="w-full flex items-center justify-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <span>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</span>
                        </button>
                    </div>
                </div>

                <!-- PWA Info -->
                <div class="bg-indigo-50 rounded-lg p-4">
                    <h3 class="font-semibold text-indigo-800 mb-2">üì± GitHub Pages</h3>
                    <p class="text-sm text-indigo-700 mb-2">TaskMaster Pro —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ GitHub Pages! üéâ</p>
                    <p class="text-xs text-indigo-600">
                        ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞<br/>
                        ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è<br/>
                        ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥<br/>
                        ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
                    </p>
                </div>
            </div>
            
            <div class="flex justify-end mt-6">
                <button onclick="closeSettings()" class="px-6 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors duration-200">–ì–æ—Ç–æ–≤–æ</button>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let tasks = [];
        let currentFilter = 'active';
        let notificationsEnabled = false;
        let settings = {
            notifications: true,
            sound: true,
            autoSort: true
        };
        let notificationTimeouts = new Map();
        let deferredPrompt = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ TaskMaster Pro –∑–∞–ø—É—â–µ–Ω!');
            initializeApp();
        });

        function initializeApp() {
            loadData();
            setupPWA();
            setupEventListeners();
            updateStats();
            renderTasks();
            checkNotificationPermission();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—Ä—ã –∑–∞–¥–∞—á –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç
            if (tasks.length === 0) {
                addSampleTasks();
            }
        }

        function addSampleTasks() {
            const sampleTasks = [
                {
                    id: Date.now(),
                    title: 'üöÄ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ TaskMaster Pro!',
                    description: '–ò–∑—É—á–∏—Ç–µ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ.',
                    priority: 'high',
                    status: 'active',
                    category: 'personal',
                    createdAt: new Date(),
                    dueDate: new Date(Date.now() + 2 * 60 * 60 * 1000),
                    reminderEnabled: true,
                    isRecurring: false,
                    comments: [
                        { id: 1, text: '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ! üéâ', timestamp: new Date() }
                    ]
                },
                {
                    id: Date.now() + 1,
                    title: '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞',
                    description: '15 –º–∏–Ω—É—Ç —É—Ç—Ä–µ–Ω–Ω–µ–π –∑–∞—Ä—è–¥–∫–∏',
                    priority: 'medium',
                    status: 'active',
                    category: 'health',
                    createdAt: new Date(),
                    dueDate: null,
                    reminderEnabled: true,
                    isRecurring: true,
                    recurringType: 'daily',
                    comments: []
                }
            ];
            tasks = sampleTasks;
            saveData();
            renderTasks();
            updateStats();
        }

        function setupPWA() {
            // –°–æ–∑–¥–∞–Ω–∏–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞
            const manifestData = {
                name: "TaskMaster Pro - –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á",
                short_name: "TaskMaster",
                description: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏",
                start_url: "./",
                display: "standalone",
                background_color: "#ffffff",
                theme_color: "#6366f1",
                orientation: "portrait-primary",
                icons: [
                    {
                        src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192' fill='%236366f1'><rect width='192' height='192' rx='24' fill='%23ffffff'/><path d='M48 96l24 24 48-48' stroke='%236366f1' stroke-width='12' fill='none' stroke-linecap='round' stroke-linejoin='round'/><circle cx='96' cy='96' r='80' stroke='%236366f1' stroke-width='8' fill='none'/></svg>",
                        sizes: "192x192",
                        type: "image/svg+xml",
                        purpose: "any maskable"
                    }
                ]
            };

            const manifestBlob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(manifestBlob);
            const manifestLink = document.createElement('link');
            manifestLink.rel = 'manifest';
            manifestLink.href = manifestURL;
            document.head.appendChild(manifestLink);

            // Service Worker
            if ('serviceWorker' in navigator) {
                const swCode = `
                    const CACHE_NAME = 'taskmaster-v1';
                    
                    self.addEventListener('install', (event) => {
                        console.log('Service Worker installing...');
                        self.skipWaiting();
                    });

                    self.addEventListener('activate', (event) => {
                        console.log('Service Worker activating...');
                        event.waitUntil(self.clients.claim());
                    });

                    self.addEventListener('notificationclick', (event) => {
                        event.notification.close();
                        event.waitUntil(
                            clients.matchAll().then((clientList) => {
                                if (clientList.length > 0) {
                                    return clientList[0].focus();
                                } else {
                                    return clients.openWindow('./');
                                }
                            })
                        );
                    });
                `;

                const swBlob = new Blob([swCode], {type: 'application/javascript'});
                const swUrl = URL.createObjectURL(swBlob);
                
                navigator.serviceWorker.register(swUrl)
                    .then((registration) => {
                        console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
                    })
                    .catch((error) => {
                        console.log('‚ùå –û—à–∏–±–∫–∞ Service Worker:', error);
                    });
            }

            // Install prompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('installPrompt').style.display = 'block';
            });

            window.addEventListener('appinstalled', (evt) => {
                console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!');
                document.getElementById('installPrompt').style.display = 'none';
            });
        }

        function setupEventListeners() {
            // Recurring checkbox
            document.getElementById('taskRecurring').addEventListener('change', function() {
                document.getElementById('recurringOptions').classList.toggle('hidden', !this.checked);
            });

            // Sound toggle
            document.getElementById('soundToggle').addEventListener('change', function() {
                settings.sound = this.checked;
                saveData();
            });
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                        document.getElementById('installPrompt').style.display = 'none';
                    }
                    deferredPrompt = null;
                });
            }
        }

        function checkNotificationPermission() {
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    notificationsEnabled = true;
                    updateNotificationUI();
                } else if (Notification.permission === 'default') {
                    document.getElementById('notificationBtn').style.display = 'block';
                }
            }
        }

        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    notificationsEnabled = permission === 'granted';
                    updateNotificationUI();
                    document.getElementById('notificationBtn').style.display = 'none';
                    
                    if (notificationsEnabled) {
                        showNotification({title: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã!'}, 0);
                    }
                });
            }
        }

        function updateNotificationUI() {
            const toggle = document.getElementById('notificationToggle');
            const status = document.getElementById('notificationStatus');
            
            if (notificationsEnabled) {
                toggle.className = 'p-2 rounded-lg transition-colors duration-200 text-green-600 bg-green-50';
                toggle.title = '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã';
                status.className = 'text-sm px-2 py-1 rounded bg-green-100 text-green-700';
                status.textContent = '–í–∫–ª—é—á–µ–Ω—ã';
            } else {
                toggle.className = 'p-2 rounded-lg transition-colors duration-200 text-gray-400 hover:text-gray-600 hover:bg-gray-50';
                toggle.title = '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã';
                status.className = 'text-sm px-2 py-1 rounded bg-red-100 text-red-700';
                status.textContent = '–û—Ç–∫–ª—é—á–µ–Ω—ã';
            }
        }

        function toggleNotifications() {
            if (notificationsEnabled) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å
                notificationsEnabled = false;
                updateNotificationUI();
            } else {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –≤–∫–ª—é—á–∏—Ç—å
                requestNotificationPermission();
            }
        }

        function showNotification(task, minutesBefore, isOverdue = false) {
            if (!notificationsEnabled) return;

            const title = isOverdue ? '‚ö†Ô∏è –ó–∞–¥–∞—á–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–∞!' : '‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–¥–∞—á–µ';
            const body = isOverdue 
                ? `"${task.title}" –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞`
                : minutesBefore === 0 
                    ? `–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å: "${task.title}"`
                    : `–ß–µ—Ä–µ–∑ ${minutesBefore} –º–∏–Ω: "${task.title}"`;

            const notification = new Notification(title, {
                body,
                icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236366f1'><path d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'/></svg>",
                tag: `task-${task.id}`,
                requireInteraction: isOverdue,
                silent: !settings.sound
            });

            notification.onclick = () => {
                window.focus();
                notification.close();
            };

            setTimeout(() => notification.close(), 10000);
        }

        function loadData() {
            try {
                const savedTasks = localStorage.getItem('taskmaster_tasks');
                const savedSettings = localStorage.getItem('taskmaster_settings');
                
                if (savedTasks) {
                    tasks = JSON.parse(savedTasks).map(task => ({
                        ...task,
                        createdAt: new Date(task.createdAt),
                        dueDate: task.dueDate ? new Date(task.dueDate) : null,
                        completedAt: task.completedAt ? new Date(task.completedAt) : null,
                        comments: task.comments?.map(comment => ({
                            ...comment,
                            timestamp: new Date(comment.timestamp)
                        })) || []
                    }));
                }
                
                if (savedSettings) {
                    settings = { ...settings, ...JSON.parse(savedSettings) };
                    document.getElementById('soundToggle').checked = settings.sound;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        function saveData() {
            try {
                localStorage.setItem('taskmaster_tasks', JSON.stringify(tasks));
                localStorage.setItem('taskmaster_settings', JSON.stringify(settings));
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        function formatDate(date) {
            if (!date) return '';
            return new Intl.DateTimeFormat('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            }).format(new Date(date));
        }

        function isOverdue(dueDate) {
            return dueDate && new Date(dueDate) < new Date();
        }

        function getCategoryIcon(category) {
            const icons = {
                work: 'üíº',
                personal: 'üè†',
                health: 'üí™',
                study: 'üìö'
            };
            return icons[category] || 'üìù';
        }

        function getPriorityClass(priority) {
            return `priority-${priority}`;
        }

        function updateStats() {
            const stats = {
                total: tasks.length,
                active: tasks.filter(t => t.status === 'active' && !t.isRecurring).length,
                completed: tasks.filter(t => t.status === 'completed').length,
                recurring: tasks.filter(t => t.isRecurring).length,
                overdue: tasks.filter(t => isOverdue(t.dueDate) && t.status === 'active').length
            };

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ header
            document.getElementById('activeCount').textContent = `üìä ${stats.active} –∞–∫—Ç–∏–≤–Ω—ã—Ö`;
            document.getElementById('recurringCount').textContent = `üîÑ ${stats.recurring} –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö`;
            
            const overdueElement = document.getElementById('overdueCount');
            if (stats.overdue > 0) {
                overdueElement.textContent = `‚ö†Ô∏è ${stats.overdue} –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–æ`;
                overdueElement.classList.remove('hidden');
            } else {
                overdueElement.classList.add('hidden');
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ö
            document.getElementById('activeFilterCount').textContent = stats.active;
            document.getElementById('recurringFilterCount').textContent = stats.recurring;
            document.getElementById('completedFilterCount').textContent = stats.completed;
            document.getElementById('allFilterCount').textContent = stats.total;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
            document.getElementById('totalTasks').textContent = stats.total;
            document.getElementById('completedTasks').textContent = stats.completed;
            document.getElementById('recurringTasks').textContent = stats.recurring;
            document.getElementById('overdueTasks').textContent = stats.overdue;
        }

        function setFilter(filter) {
            currentFilter = filter;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.className = 'filter-btn flex items-center space-x-2 px-4 py-2 rounded-xl transition-all duration-200 bg-white text-gray-600 hover:bg-gray-50 border border-gray-200';
            });
            
            event.target.className = 'filter-btn active flex items-center space-x-2 px-4 py-2 rounded-xl transition-all duration-200 bg-indigo-500 text-white shadow-lg';
            
            renderTasks();
        }

        function filterTasks() {
            renderTasks();
        }

        function sortTasks(tasksToSort) {
            if (!settings.autoSort) return tasksToSort;
            
            return [...tasksToSort].sort((a, b) => {
                // –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –Ω–∞–≤–µ—Ä—Ö
                const aOverdue = isOverdue(a.dueDate) && a.status === 'active';
                const bOverdue = isOverdue(b.dueDate) && b.status === 'active';
                if (aOverdue && !bOverdue) return -1;
                if (!aOverdue && bOverdue) return 1;
                
                // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                const priorityOrder = { 'high': 3, 'medium': 2, 'low': 1 };
                const priorityDiff = priorityOrder[b.priority] - priorityOrder[a.priority];
                if (priorityDiff !== 0) return priorityDiff;
                
                // –î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                if (a.dueDate && b.dueDate) {
                    return new Date(a.dueDate) - new Date(b.dueDate);
                }
                if (a.dueDate && !b.dueDate) return -1;
                if (!a.dueDate && b.dueDate) return 1;
                
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
        }

        function renderTasks() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            const filteredTasks = sortTasks(tasks.filter(task => {
                const matchesFilter = currentFilter === 'all' || 
                                     (currentFilter === 'active' && task.status === 'active' && !task.isRecurring) ||
                                     (currentFilter === 'completed' && task.status === 'completed') ||
                                     (currentFilter === 'recurring' && task.isRecurring);
                
                const matchesSearch = task.title.toLowerCase().includes(searchTerm) ||
                                     task.description.toLowerCase().includes(searchTerm);
                
                return matchesFilter && matchesSearch;
            }));

            const taskList = document.getElementById('taskList');
            const emptyState = document.getElementById('emptyState');

            if (filteredTasks.length === 0) {
                taskList.innerHTML = '';
                emptyState.classList.remove('hidden');
                
                const emptyTexts = {
                    active: '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á',
                    completed: '–ù–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–¥–∞—á',
                    recurring: '–ù–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∑–∞–¥–∞—á',
                    all: '–ù–µ—Ç –∑–∞–¥–∞—á'
                };
                document.getElementById('emptyStateText').textContent = emptyTexts[currentFilter];
            } else {
                emptyState.classList.add('hidden');
                taskList.innerHTML = filteredTasks.map(task => createTaskHTML(task)).join('');
            }
        }

        function createTaskHTML(task) {
            const isTaskOverdue = isOverdue(task.dueDate) && task.status === 'active';
            const overdueClass = isTaskOverdue ? 'overdue' : '';
            const completedClass = task.status === 'completed' ? 'line-through text-gray-500' : '';
            
            return `
                <div class="task-card bg-white/80 backdrop-blur-sm rounded-2xl border-l-4 ${getPriorityClass(task.priority)} shadow-sm ${overdueClass} overflow-hidden">
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-start space-x-3 flex-1">
                                <button onclick="toggleTaskStatus(${task.id})" class="mt-1 flex-shrink-0 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all duration-200 ${
                                    task.status === 'completed'
                                        ? 'bg-green-500 border-green-500 text-white'
                                        : 'border-gray-300 hover:border-indigo-500 hover:bg-indigo-50'
                                }">
                                    ${task.status === 'completed' ? '‚úì' : ''}
                                </button>
                                
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <span class="text-lg">${getCategoryIcon(task.category)}</span>
                                        ${task.isRecurring ? '<span class="text-blue-500" title="–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –∑–∞–¥–∞—á–∞">üîÑ</span>' : ''}
                                        ${task.reminderEnabled ? '<span class="text-green-500" title="–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã">üîî</span>' : ''}
                                        ${isTaskOverdue ? '<span class="text-red-500" title="–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ!">‚ö†Ô∏è</span>' : ''}
                                        <h3 class="text-lg font-semibold ${completedClass} ${isTaskOverdue ? 'text-red-700' : 'text-gray-800'}">${task.title}</h3>
                                    </div>
                                    
                                    ${task.description ? `<p class="text-gray-600 mb-3 ${completedClass}">${task.description}</p>` : ''}
                                    
                                    <div class="flex flex-wrap items-center gap-3 text-sm text-gray-500">
                                        <span class="flex items-center space-x-1">
                                            <span>üìÖ</span>
                                            <span>–°–æ–∑–¥–∞–Ω–æ: ${formatDate(task.createdAt)}</span>
                                        </span>
                                        
                                        ${task.dueDate ? `
                                            <span class="flex items-center space-x-1 ${isTaskOverdue ? 'text-red-500 font-medium' : ''}">
                                                <span>‚è∞</span>
                                                <span>${isTaskOverdue ? '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ: ' : '–°—Ä–æ–∫: '}${formatDate(task.dueDate)}</span>
                                            </span>
                                        ` : ''}
                                        
                                        ${task.isRecurring ? `
                                            <span class="flex items-center space-x-1 text-blue-600">
                                                <span>üîÑ</span>
                                                <span>${task.recurringType === 'daily' ? '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ' : task.recurringType === 'weekly' ? '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ' : '–ï–∂–µ–º–µ—Å—è—á–Ω–æ'}</span>
                                            </span>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-2 ml-4">
                                <div class="w-3 h-3 rounded-full ${getPriorityColor(task.priority)}" title="–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${task.priority}"></div>
                                <button onclick="toggleComments(${task.id})" class="relative p-2 text-gray-400 hover:text-indigo-500 hover:bg-indigo-50 rounded-lg transition-colors duration-200">
                                    <span>üí¨</span>
                                    ${task.comments?.length > 0 ? `<span class="absolute -top-1 -right-1 bg-indigo-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">${task.comments.length}</span>` : ''}
                                </button>
                                <button onclick="deleteTask(${task.id})" class="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors duration-200">
                                    <span>üóëÔ∏è</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="comments-${task.id}" class="hidden border-t border-gray-100 bg-gray-50/50 p-4">
                        <div class="space-y-3 mb-4 max-h-40 overflow-y-auto">
                            ${task.comments?.map(comment => `
                                <div class="bg-white rounded-lg p-3 border border-gray-100">
                                    <p class="text-gray-800 text-sm mb-1">${comment.text}</p>
                                    <p class="text-xs text-gray-500">${formatDate(comment.timestamp)}</p>
                                </div>
                            `).join('') || ''}
                        </div>
                        
                        <div class="flex space-x-2">
                            <input type="text" id="comment-input-${task.id}" placeholder="–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." class="flex-1 px-3 py-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" onkeypress="if(event.key==='Enter') addComment(${task.id})">
                            <button onclick="addComment(${task.id})" class="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors duration-200">
                                <span>üì§</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function getPriorityColor(priority) {
            const colors = {
                high: 'bg-red-500',
                medium: 'bg-yellow-500',
                low: 'bg-green-500'
            };
            return colors[priority] || 'bg-gray-500';
        }

        function toggleAddForm() {
            document.getElementById('addTaskModal').classList.add('active');
            document.getElementById('taskTitle').focus();
        }

        function closeAddForm() {
            document.getElementById('addTaskModal').classList.remove('active');
            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskPriority').value = 'medium';
            document.getElementById('taskCategory').value = 'personal';
            document.getElementById('taskDueDate').value = '';
            document.getElementById('taskRecurring').checked = false;
            document.getElementById('taskRecurringType').value = 'daily';
            document.getElementById('taskReminder').checked = true;
            document.getElementById('recurringOptions').classList.add('hidden');
        }

        function addTask() {
            const title = document.getElementById('taskTitle').value.trim();
            if (!title) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏');
                return;
            }

            const task = {
                id: Date.now(),
                title,
                description: document.getElementById('taskDescription').value.trim(),
                priority: document.getElementById('taskPriority').value,
                category: document.getElementById('taskCategory').value,
                dueDate: document.getElementById('taskDueDate').value ? new Date(document.getElementById('taskDueDate').value) : null,
                isRecurring: document.getElementById('taskRecurring').checked,
                recurringType: document.getElementById('taskRecurringType').value,
                reminderEnabled: document.getElementById('taskReminder').checked,
                status: 'active',
                createdAt: new Date(),
                comments: [],
                lastRecurrence: document.getElementById('taskRecurring').checked ? new Date() : null
            };

            tasks.unshift(task);
            saveData();
            updateStats();
            renderTasks();
            closeAddForm();
            
            console.log('‚úÖ –ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞:', task.title);
        }

        function toggleTaskStatus(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            const newStatus = task.status === 'active' ? 'completed' : 'active';
            
            if (task.isRecurring && newStatus === 'completed') {
                // –î–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–¥–∞—á —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ
                const nextDueDate = calculateNextRecurrence(task.dueDate, task.recurringType);
                task.status = 'active';
                task.completedAt = null;
                task.dueDate = nextDueDate;
                task.lastRecurrence = new Date();
                task.comments = [...(task.comments || []), {
                    id: Date.now(),
                    text: `‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ ${formatDate(new Date())}`,
                    timestamp: new Date()
                }];
            } else {
                task.status = newStatus;
                task.completedAt = newStatus === 'completed' ? new Date() : null;
            }

            saveData();
            updateStats();
            renderTasks();
        }

        function calculateNextRecurrence(currentDate, type) {
            if (!currentDate) return new Date();
            
            const nextDate = new Date(currentDate);
            switch(type) {
                case 'daily':
                    nextDate.setDate(nextDate.getDate() + 1);
                    break;
                case 'weekly':
                    nextDate.setDate(nextDate.getDate() + 7);
                    break;
                case 'monthly':
                    nextDate.setMonth(nextDate.getMonth() + 1);
                    break;
            }
            return nextDate;
        }

        function deleteTask(taskId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                saveData();
                updateStats();
                renderTasks();
            }
        }

        function toggleComments(taskId) {
            const commentsDiv = document.getElementById(`comments-${taskId}`);
            commentsDiv.classList.toggle('hidden');
            
            if (!commentsDiv.classList.contains('hidden')) {
                document.getElementById(`comment-input-${taskId}`).focus();
            }
        }

        function addComment(taskId) {
            const input = document.getElementById(`comment-input-${taskId}`);
            const text = input.value.trim();
            
            if (!text) return;

            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            const comment = {
                id: Date.now(),
                text,
                timestamp: new Date()
            };

            task.comments = task.comments || [];
            task.comments.push(comment);
            
            input.value = '';
            saveData();
            renderTasks();
        }

        function toggleSettings() {
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function exportData() {
            const data = {
                tasks,
                settings,
                exportDate: new Date(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `taskmaster-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.tasks) {
                        const importedTasks = data.tasks.map(task => ({
                            ...task,
                            id: task.id + Date.now(), // –ò–∑–±–µ–≥–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ ID
                            createdAt: new Date(task.createdAt),
                            dueDate: task.dueDate ? new Date(task.dueDate) : null,
                            completedAt: task.completedAt ? new Date(task.completedAt) : null,
                            comments: task.comments?.map(comment => ({
                                ...comment,
                                timestamp: new Date(comment.timestamp)
                            })) || []
                        }));
                        
                        tasks = [...importedTasks, ...tasks];
                    }
                    
                    if (data.settings) {
                        settings = { ...settings, ...data.settings };
                        document.getElementById('soundToggle').checked = settings.sound;
                    }
                    
                    saveData();
                    updateStats();
                    renderTasks();
                    alert('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
                } catch (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞');
                    console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
                }
            };
            reader.readAsText(file);
        }
        
        // –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function scheduleNotifications() {
            if (!notificationsEnabled) return;

            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ç–∞–π–º–µ—Ä—ã
            notificationTimeouts.forEach(timeout => clearTimeout(timeout));
            notificationTimeouts.clear();

            tasks.filter(task => task.status === 'active' && task.reminderEnabled && task.dueDate).forEach(task => {
                const now = new Date();
                const dueDate = new Date(task.dueDate);
                
                // –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 5, 15, 60 –º–∏–Ω—É—Ç
                [5, 15, 60].forEach(minutes => {
                    const reminderTime = new Date(dueDate.getTime() - minutes * 60 * 1000);
                    const timeToReminder = reminderTime.getTime() - now.getTime();
                    
                    if (timeToReminder > 0) {
                        const timeoutId = setTimeout(() => {
                            showNotification(task, minutes);
                        }, timeToReminder);
                        
                        notificationTimeouts.set(`${task.id}-${minutes}`, timeoutId);
                    }
                });

                // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ—Å—Ä–æ—á–∫–µ
                if (dueDate.getTime() < now.getTime()) {
                    const overdueMins = Math.floor((now.getTime() - dueDate.getTime()) / (1000 * 60));
                    if (overdueMins <= 60) {
                        showNotification(task, 0, true);
                    }
                }
            });
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
        setInterval(scheduleNotifications, 60000);
        
        console.log('üéâ TaskMaster Pro –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');
    </script>
</body>
</html>
